<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:v="urn:schemas-microsoft-com:vml">

<head>
  <title>High Frequency Radar</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" http-equiv="content-type">
  <meta name="keywords" content="hfradar,rtv,surface currents,ocean currents">
  <meta name="copyright" content="©2020 Coastal Observing Research and Development Center">
  <meta http-equiv="ScreenOrientation" content="autoRotate:disabled">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">

  <!--
  <link rel="stylesheet" href="css/index.css" />
  <script src="js/index.js"></script>
  -->

    <!--UIKit Dependencies-->
    <link rel="stylesheet" type="text/css" href="css/uikit.min.css" />
    <script type="text/javascript" src="js/uikit.min.js"></script>
    <script type="text/javascript" src="js/uikit-icons.min.js"></script>
  
    <!--Google Maps and HFR API-->
    <script type="text/javascript" src="https://maps.google.com/maps/api/js?key=AIzaSyD4u52jjez_Lk1Kyj8jeRKNw-ik5Q8-AdI&amp;v=3"></script>
    <script type="text/javascript" src="http://cordc.ucsd.edu/js/RTV/RTVMapType.js"></script>
  
    <script>
      window.addEventListener('load', (event) => {
          console.log('page is fully loaded');
      });
      // The GMap3 object
      var map = null;
  
      // The RTVMapType object.
      var overlay = null;
  
  
      /**
       * Initialize the Google map.
       */
      function initialize() {
        var opts = {
          center: new google.maps.LatLng(34.4, -119.8),
          zoom: 8,
          disableDefaultUI: true,
          scaleControl: false,
          mapTypeControl: true,
          mapTypeControlOptions: {
            style: google.maps.MapTypeControlStyle.SMALL,
            position: google.maps.ControlPosition.RIGHT_BOTTOM,
          },
          mapTypeId: google.maps.MapTypeId.TERRAIN,
          zoomControl: true,
          zoomControlOptions: {
            position: google.maps.ControlPosition.LEFT_BOTTOM,
            style: google.maps.ZoomControlStyle.SMALL
          },
          controlSize: 20
        };
        map = new google.maps.Map(document.getElementById("map_canvas"), opts);
  
  
  
        /**
         * Get reference to the new overlay, so we can monitor for
         * state (configuration) changes.
         */
        overlay = new RTVMapType(map);
  
        // Show user the latest timestamp when map layer loads
        google.maps.event.addListener(overlay, 'timechange', function (ts) {
          displayTimestamp(ts);
        });
  
        // Display date and current and utc times
        displayDate();
        displayCurTime();
        setInterval(displayCurTime, 1000);
        displayUTCTime();
        setInterval(displayUTCTime, 1000);
  
  
        // Add overlay to map.
        map.overlayMapTypes.push(overlay);
  
        // When a user clicks on the map, an object representing
        // the nearest neighbor of the click will be returned.
        // The object will have properties: lat, lng, u, v.
        // With u and v in 'cm/s'.
        google.maps.event.addListener(map, 'click', function (mouseEvt) {
          overlay.getVectorData(mouseEvt.latLng, lluvAtClick);
        });
  
        // shortcut to get image bar to render with current settings
        doSubmitColor();
      }
  
      /**
       * Action code to handle the result of onclick.  
       * Note, a timeout is needed between clicks to prevent capturing 
       * double-click events.  I expected this to be implemented by 
       * Google, but it's been years, and no support.
       */
      function lluvAtClick(obj) {
        console.log(obj);
        var pfx = "";
        if(document.getElementById('hourly').checked == true) {
          pfx = "Hourly";
        }else {
          pfx = "Averaged";
        }

        var multiplier = getUnitMultiplier();
        var unit = getFormValueColorbar('select_unit');

        alert('Latitude: ' + obj.lat + ', Longitude: ' + obj.lng + '\n' + 'Current Vector: U: ' + Number.parseFloat(obj.u / multiplier).toPrecision(3) + unit + ', V: ' + Number.parseFloat(obj.v / multiplier).toPrecision(3) + unit + '\n PFX: ' + pfx + ', Resolution: ' + getFormValueProducts('select_res'));
      }
  
      function displayDate() {
        var date = new Date();
        document.getElementById("date").innerHTML = date.toDateString();
      }
  
      /**
       * Display the current and UTC time and set interval
       */
       function displayCurTime() {
        var date = new Date();
        var abbrev = String(String(date).split("(")[1]).split(")")[0];
        document.getElementById("cur-time").innerHTML = date.toLocaleTimeString() + " (" + abbrev + ")";
      }
  
      function displayUTCTime() {
        var date = new Date();
        var ifZeroSec = "";
        var ifZeroMin = "";
        var ifZeroHour = "";
        if(date.getUTCSeconds() < 10){
          ifZeroSec = "0";
        }
        if(date.getUTCMinutes() < 10){
          ifZeroMin = "0";
        }
        if(date.getUTCHours() < 10){
          ifZeroHour = "0";
        }
        document.getElementById("utc-time").innerHTML = "  " + ifZeroHour + date.getUTCHours() + ":" + ifZeroMin + date.getUTCMinutes() + ":" + ifZeroSec + date.getUTCSeconds() + " (GMT)";
      }
  
      /**
       * Just something to show the user what time is being displayed.
       */
      function displayTimestamp(ts) {
        var frm = document.forms["timestep"];
        var d = new Date(Number(ts) * 1000);
        console.log(ts + ", " + d);
        frm["ts"].disabled = false;
        frm["ts"].value = d.gmstrftime("%m-%d-%Y %H:%M:%S UTC");
        console.log(frm["ts"].value);
        frm["ts"].disabled = true;
      }
  
      /**
       * Example accessor for updating time without extending 
       * beyong most recent available.
       */
      function incrementTime(dt) {
        ts = overlay.getLatestTimestamp();
        console.log("timestamp: " + overlay.getTimestamp());
        overlay.setTimestamp(Math.min(ts, overlay.getTimestamp() + dt));
      }
  
      /**
       * Get the form value of colorbar
       */
       function getFormValueColorbar(field) {
        var frm = document.forms['colorbar'];
        if (!frm[field]) {
          return null;
        }
        if (typeof (frm[field].value) != "undefined") {
          return frm[field].value;
        }
        if (frm[field].length != "undefined") {
          for (var i = 0, n = frm[field].length; i < n; i++) {
            if (frm[field][i].checked) {
              return frm[field][i].value;
            }
          }
        }
        return null;
      }

      /**
       * Get the form value of PFX
       */
       function getFormValueProducts(field) {
        var frm = document.forms['products'];
        if (!frm[field]) {
          return null;
        }
        if (typeof (frm[field].value) != "undefined") {
          return frm[field].value;
        }
        if (frm[field].length != "undefined") {
          for (var i = 0, n = frm[field].length; i < n; i++) {
            if (frm[field][i].checked) {
              return frm[field][i].value;
            }
          }
        }
        return null;
      }
  
      /**
       * Get the form value of something else
       */
       function getFormValue(field) {
        var frm = document.forms['something'];
        if (!frm[field]) {
          return null;
        }
        if (typeof (frm[field].value) != "undefined") {
          return frm[field].value;
        }
        if (frm[field].length != "undefined") {
          for (var i = 0, n = frm[field].length; i < n; i++) {
            if (frm[field][i].checked) {
              return frm[field][i].value;
            }
          }
        }
        return null;
      }
  
  
      /**
       * Accessors for updating rtv configuration
       */
  
      function setProducts() {
        var hourlyChecked = document.getElementById('hourly').checked;
        if (hourlyChecked) {
          overlay.setAveraged(false);
          overlay.setHourly(true);
        } else {
          overlay.setHourly(false);
          overlay.setAveraged(true);
        }
      }
  
      function changeResolution() {
        overlay.setResolution(getFormValueProducts('select_res'));
      }

      function getUnitMultiplier() {
        var curUnit = getFormValueColorbar('select_unit');

        if(curUnit == 'm/s') {
          return 100;
        }else if(curUnit == 'kph') {
          return 27.77777778;
        }else if(curUnit == 'kts') {
          return 51.44444444;
        }else if(curUnit == 'mph') {
          return 44.70400;
        }else if(curUnit == 'ft/s') {
          return 30.48;
        }else if(curUnit == 'in/s') {
          return 2.54;
        }

        return 1;
      }
  
      function changeUnit() {
        var img = document.getElementById("colorbar");
        var curUnit = getFormValueColorbar('select_unit');
        document.getElementById('unit-text').innerHTML = curUnit;
  
        img.src = overlay.getColorbarUrl().replace('cm/s', curUnit);
      }
  
      function changeColorScheme()  {
        overlay.setColorScheme(getFormValueColorbar('colors'));
        changeUnit();
      }
  
      function changeColorRange() {
        overlay.setColorRange(getFormValueColorbar('min'), getFormValueColorbar('max'));
        changeUnit();
      }
  
      /** Example colorbar url
       * https://cordc.ucsd.edu/projects/mapping/maps/img/php/cb.php?range=0,50&amp;scheme=4&amp;width=204&amp;height=15&amp;
       * padding=15,8&amp;title=Current%20Strength%20%28cm/s%29&amp;font_size=10&amp;ticks=6
       */
  
      function doSubmitColor() {
        changeColorScheme();
        changeColorRange();
        changeUnit();
      }
    
    /**
       * Center the map at given latitude/longitude
       */

    function setCoordinates() {
      var frm = document.forms['coordinates'];
      if (!frm) {
        return null;
      }

      console.log("(" + frm['lat'].value + ", " + frm['long'].value + ")");
      
      if(frm['lat'].value != "" && frm['long'].value != "") {
        map.setZoom(11);
        map.setCenter({lat: parseFloat(frm['lat'].value),
                      lng: parseFloat(frm['long'].value)});
      }
    }

    function setCoordinatesHome() {
      alert("button still crashing");
      map.setZoom(8);
      map.setCenter({lat: 34.4, lng: -119.8});
    }

    </script>
</head>

<body onload="initialize()" style="overflow: hidden">
    <!--Map-->
    <div id="map_canvas" style="z-index: -1; width: 100vw; height: 100vh; float: left; top: 0px; overflow: hidden; position: absolute;"></div>

    <!--Nav bar-->
    <div class="uk-position-relative">
      <nav class="uk-navbar-container" uk-navbar="mode: click;">
        
        <!--Nav Bar Left-->
        <div class="uk-navbar-left">
          <ul class="uk-navbar-nav">
            <li>
              <button class="uk-button uk-button-default uk-button-small uk-margin-small-left uk-margin-top uk-margin-bottom" type="button" uk-toggle="target: #left-slide">Control Panel</button>
            </li>
        </div>
      

        <!--Logo-->
        <div class="uk-navbar-center">
          <a class="uk-navbar-item uk-logo" href="#">
            LOGO<!--<img style="height: 2vh" src="https://sccoos.org/wp-content/uploads/2020/06/cropped-SCCOOS_LOGO_white_medium-1-1.png" alt="logo">-->
          </a>
        </div>

        <!--Nav Bar Right-->
        <div class="uk-navbar-right">
          <ul class="uk-navbar-nav">
            <li>
              <button class="uk-button uk-button-default uk-button-small uk-margin-small-right" type="button" href="#">Settings</button>
              <div class="uk-navbar-dropdown" uk-drop="boundary: #navbar; mode: click">
                <ul class="uk-nav uk-navbar-dropdown-nav">
                  <li class="uk-active"><a href="#">Active</a></li>
                  <li><a href="#">About the Washburn Lab</a></li>
                  <li><a href="#modal-sections" uk-toggle>Current Vector</a></li>
                  <li><a href="#">Saved HFR Locations</a></li>
                  <li class="uk-nav-header">Header</li>
                  <li><a href="#">Documentation</a></li>
                  <li><a href="#">How to Use this App</a></li>
                  <li class="uk-nav-divider"></li>
                  <li><a href="#">Item</a></li>
                </ul>
              </div>
            </li>
          </ul>
        </div>
      </nav>
    </div>
    <!--End Nav Bar-->

    <!--Nav Bar Left Slide-->
    <div id="left-slide" uk-offcanvas="overlay: true; mode: slide;">
      <div class="uk-offcanvas-bar uk-width-5-6">
          <button class="uk-offcanvas-close" type="button" uk-close></button>
          <br>
          <ul class="uk-nav uk-nav-default">
              <!--Date and Time-->
              <li class="uk-active"><a id="date" href="#">Date</a></li>
              <ul class="uk-nav-sub">
                  <li>Local:  <span id="cur-time"></span></li>
                  <li>UTC:    <span id="utc-time"></span></li>
              </ul>
              <li class="uk-nav-divider"></li>

              <!--Control Panel-->
              <li class="uk-nav-header uk-text-medium">Control Panel</li>
              <br>
              
              <ul uk-accordion="multiple: true">
                <li><a class="uk-text-muted uk-margin-small-left uk-text-capitalize uk-text-default uk-accordion-title" href="#">Timestep</a>
                  <div class="uk-accordion-content">    
                          <form name="timestep" method="post">
                            <div class="uk-margin-left">
                              <input class="uk-input uk-form-width-medium" type="text" name="ts" size="25" value="Waiting..." disabled="">
                              <br>
                              <a href="#" onclick="incrementTime(-86400);return false">-1 Day</a> &nbsp;
                              <a class="uk-margin-small-right" href="#" onclick="incrementTime(-3600);return false">-1 Hour</a> &nbsp;
                              <a href="#" onclick="incrementTime(+3600);return false">+1 Hour</a> &nbsp;
                              <a href="#" onclick="incrementTime(+86400);return false">+1 Day</a>
                            </div>
                          </form>
                      <!--
                        <div id="meta_timestep">
                          <span onclick="javascript:time_advanceSeconds(-86400);" style="color: rgb(0, 0, 255); cursor: pointer;">« -1 Day</span> &nbsp;
                          <span onclick="javascript:time_advanceSeconds(-3600);" style="color: rgb(0, 0, 255); cursor: pointer;"> -1 Hour</span> &nbsp;
                          <span id="t0_sp">2021-01-02 08:00:00</span> &nbsp;
                        <select name="tzo" id="tzoSel">
                          <option value="-43200">-12:00</option>
                          <option value="-39600">-11:00</option>
                          <option value="-36000">-10:00</option>
                          <option value="-34200">-09:30</option>
                          <option value="-32400">-09:00</option>
                          <option value="-28800">-08:00</option>
                          <option value="-25200">-07:00</option>
                          <option value="-21600">-06:00</option>
                          <option value="-18000">-05:00</option>
                          <option value="-16200">-04:30</option>
                          <option value="-14400">-04:00</option>
                          <option value="-12600">-03:30</option>
                          <option value="-10800">-03:00</option>
                          <option value="-7200">-02:00</option>
                          <option value="-3600">-01:00</option>
                          <option value="0" selected="selected">+00:00</option>
                          <option value="+3600">+01:00</option>
                          <option value="+7200">+02:00</option>
                          <option value="+10800">+03:00</option>
                          <option value="+12600">+03:30</option>
                          <option value="+14400">+04:00</option>
                          <option value="+16200">+04:30</option>
                          <option value="+18000">+05:00</option>
                          <option value="+19800">+05:30</option>
                          <option value="+20700">+05:45</option>
                          <option value="+21600">+06:00</option>
                          <option value="+23400">+06:30</option>
                          <option value="+25200">+07:00</option>
                          <option value="+28800">+08:00</option>
                          <option value="+31500">+08:45</option>
                          <option value="+32400">+09:00</option>
                          <option value="+34200">+09:30</option>
                          <option value="+36000">+10:00</option>
                          <option value="+37800">+10:30</option>
                          <option value="+39600">+11:00</option>
                          <option value="+41400">+11:30</option>
                          <option value="+43200">+12:00</option>
                          <option value="+45900">+12:45</option>
                          <option value="+46800">+13:00</option>
                          <option value="+50400">+14:00</option>
                        </select> from UTC &nbsp;
                          <span id="t0" style="display:none;">1609603200</span>
                          <span onclick="javascript:time_advanceSeconds(+3600);" style="color: rgb(0, 0, 255); cursor: pointer;">+1 Hour </span>&nbsp;
                          <span onclick="javascript:time_advanceSeconds(+86400);" style="color: rgb(0, 0, 255); cursor: pointer;">+1 Day »</span>
                        </div>

                      -->
                  </div>
                </li>
                <li><a class="uk-text-muted uk-margin-small-left uk-text-capitalize uk-text-default uk-accordion-title" href="#">RTV Products</a>
                  <div class="uk-accordion-content">
                    <form name="products" method="post">
                      <div class="uk-margin-left">
                        <label><input id="averaged" class="uk-radio" type="radio" onchange="setProducts()" name="radio2" checked> Averaged   </label>
                        <label><input id="hourly" class="uk-radio" type="radio" name="radio2" onchange="setProducts()"> Hourly</label>
                      </div>
                      <br>
                      <div class="uk-margin-left">
                        Resolution: <select name="select_res" class="uk-select uk-form-width-xsmall" onchange="changeResolution()">
                          <option value="500m">500m</option>
                          <option value="1km">1km</option>
                          <option value="2km">2km</option>
                          <option value="6km" selected="selected">6km</option>
                        </select>
                    </div>
                    </form>
                  </div>
                </li>
                <li><a class="uk-text-muted uk-margin-small-left uk-text-capitalize uk-text-default uk-accordion-title" href="#">Colorbar</a>
                  <div class="uk-accordion-content uk-margin-small-left">
                    <form name="colorbar" method="post" action="javascript:doSubmitColor()">
                      <img class="uk-margin-left"
                        src="https://cordc.ucsd.edu/projects/mapping/maps/img/php/cb.php?range=0,50&amp;scheme=4&amp;width=204&amp;height=15&amp;padding=15,8&amp;title=Current%20Strength%20%28cm/s%29&amp;font_size=10&amp;ticks=6"
                        id="colorbar" alt="">
                        <br><br>
                        <div class="uk-margin-left">
                          Color Scheme: <select class="uk-select uk-form-width-medium" name="colors" onchange="changeColorScheme()">
                            <option value="0" title="img/php/cb.php?width=40&amp;height=15&amp;scheme=0&amp;bg=0x7fffffff&amp;ticks=0">Jet</option>
                            <option value="1" title="img/php/cb.php?width=40&amp;height=15&amp;scheme=1&amp;bg=0x7fffffff&amp;ticks=0">Heat</option>
                            <option value="3" title="img/php/cb.php?width=40&amp;height=15&amp;scheme=3&amp;bg=0x7fffffff&amp;ticks=0">Cold</option>
                            <option value="4" title="img/php/cb.php?width=40&amp;height=15&amp;scheme=4&amp;bg=0x7fffffff&amp;ticks=0" selected="selected">Default</option>
                            <option value="2" title="img/php/cb.php?width=40&amp;height=15&amp;scheme=2&amp;bg=0x7fffffff&amp;ticks=0">Bright Default</option>
                            <option value="5" title="img/php/cb.php?width=40&amp;height=15&amp;scheme=5&amp;bg=0x7fffffff&amp;ticks=0">Purple-Orange</option>
                            <option value="6" title="img/php/cb.php?width=40&amp;height=15&amp;scheme=6&amp;bg=0x7fffffff&amp;ticks=0">Blue-Red</option>
                            <option value="7" title="img/php/cb.php?width=40&amp;height=15&amp;scheme=7&amp;bg=0x7fffffff&amp;ticks=0">Blue-Red-2</option>
                            <option value="8" title="img/php/cb.php?width=40&amp;height=15&amp;scheme=8&amp;bg=0x7fffffff&amp;ticks=0">Ocean</option>
                            <option value="9" title="img/php/cb.php?width=40&amp;height=15&amp;scheme=9&amp;bg=0x7fffffff&amp;ticks=0">Grayscale</option>
                            <option value="10" title="img/php/cb.php?width=40&amp;height=15&amp;scheme=10&amp;bg=0x7fffffff&amp;ticks=0">Thermal</option>
                            <option value="11" title="img/php/cb.php?width=40&amp;height=15&amp;scheme=11&amp;bg=0x7fffffff&amp;ticks=0">Heatmap</option>
                            <option value="12" title="img/php/cb.php?width=40&amp;height=15&amp;scheme=12&amp;bg=0x7fffffff&amp;ticks=0">Stoplight</option>
                        </select>
                      </div>
                      <br>
                      <div class="uk-margin-left">
                        Colorbar range (<span id="unit-text">cm/s</span>):
                        <br>
                        <span class="uk-margin-left-large">min
                          <input class="uk-input uk-form-width-xsmall" type="text" size="3" value="0" name="min" onchange="changeColorRange()">
                          &nbsp; max 
                          <input class="uk-input uk-form-width-xsmall" type="text" size="3" value="50" name="max" onchange="changeColorRange()">
                        </span>
                      </div>
                      <br>
                      <div class="uk-margin-left">
                        Units: 
                          <select name="select_unit" class="uk-select uk-form-width-xsmall" onchange="changeUnit()">
                            <option value="cm/s" selected="selected">cm/s</option>
                            <option value="m/s">m/s</option>
                            <option value="kph">kph</option>
                            <option value="kts">kts</option>
                            <option value="mph">mph</option>
                            <option value="ft/s">ft/s</option>
                            <option value="in/s">in/s</option>
                          </select>
                        <br>
                      </div>
                      <!--<input class="uk-button-small uk-button-primary uk-margin-large-left" type="submit" value="Update">-->
                    </form>
                  </div>
                </li>
                <li><a class="uk-text-muted uk-margin-small-left uk-text-capitalize uk-text-default uk-accordion-title" href="#">Overlays</a>
                  <div class="uk-accordion-content">
                    <p>Hello World</p>
                  </div>
                </li>
                <li><a class="uk-text-muted uk-margin-small-left uk-text-capitalize uk-text-default uk-accordion-title" href="#">Coordinate Locator</a>
                  <div class="uk-accordion-content">
                    <form name="coordinates" method="post">
                      <div class="uk-margin-left">
                        Latitude:  <input class="uk-input uk-form-width-small" name="lat" onchange="setCoordinates()" type="number" step="0.001" placeholder="Latitude">
                        <br><br>
                        Longitude:  <input class="uk-input uk-form-width-small" name="long" onchange="setCoordinates()" type="number" step="0.001" placeholder="Longitude">
                        <br><br>
                        <button class="uk-button uk-button-primary uk-button-small" onclick="setCoordinatesHome()">Home Coordinates</button>
                      </div>  
                    </form>
                  </div>
                </li>
                <li><a class="uk-text-muted uk-margin-small-left uk-text-capitalize uk-text-default uk-accordion-title" href="#">Stations</a>
                  <div class="uk-accordion-content">
                    <p>Hello World</p>
                  </div>
                </li>
              </ul>

        </ul>
      </div>
    </div>

  <!--Card?-->
  <!--
  <div class="uk-card uk-card-small uk-card-default uk-position-bottom-left uk-width-1-3" style="position: absolute; bottom: 2vh; left: 1vw">
    <div class="uk-card-header">
      <h6 class="uk-card-title">Title here</h6>
    </div>
    <div class="uk-card-body">
      <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit</p>
    </div>
  </div>-->


  
  <!--Modal?-->
  <!--
  <div id="modal-sections" uk-modal>
      <div class="uk-modal-dialog">
          <button class="uk-modal-close-default" type="button" uk-close></button>
          <div class="uk-modal-header">
              <h2 class="uk-modal-title">Modal Title</h2>
          </div>
          <div class="uk-modal-body">
              <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
          </div>
      </div>
  </div>
-->
</body>
</html>
